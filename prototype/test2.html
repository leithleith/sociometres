<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Structure Header/Menu/Sous-menu/Main/Footer</title>
    <style>
        :root{
        --h-header: 64px;
        --h-menu: 54px;
        --h-submenu: 52px;
        --h-footer: 44px;
        --bg: #0b1220;
        --panel: rgba(17, 27, 48, 0.78);
        --panel-strong: #8b0000;
        --border: rgba(226, 232, 240, 0.14);
        --text: #e5e7eb;
        --muted: rgba(229, 231, 235, 0.75);
        --tab-bg: rgba(226, 232, 240, 0.10);
        --tab-text: #e5e7eb;
        --tab-active-bg: #e2e8f0;
        --tab-active-text: #0b1220;
        --accent: #a5b4fc;
        --accent2: #38bdf8;
        --radius: 14px;
        --gap: 14px;
        --shadow: 0 10px 30px rgba(0,0,0,0.22);
        --shadow-top: 0 8px 24px rgba(0,0,0,0.18);
        --shadow-bottom: 0 -8px 24px rgba(0,0,0,0.18);
        }
        *{ box-sizing: border-box; }
        body{
        margin: 0;
        height: 100vh;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(1200px 600px at 20% 10%, rgba(56,189,248,0.12), transparent 60%),
                    radial-gradient(900px 500px at 80% 20%, rgba(165,180,252,0.12), transparent 55%),
                    linear-gradient(180deg, #070b14 0%, var(--bg) 60%, #070b14 100%);
        overflow: hidden;
        }
        header{
        position: fixed; inset: 0 0 auto 0;
        height: var(--h-header);
        display: flex; align-items: center; gap: 12px;
        padding: 0 18px;
        background: var(--panel-strong);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        box-shadow: var(--shadow-top);
        z-index: 1000;
        }
        header .brand{
        font-weight: 800;
        letter-spacing: 0.2px;
        }
        header .hint{
        margin-left: auto;
        font-size: 12px;
        opacity: 0.8;
        white-space: nowrap;
        }
        nav.menu, nav.submenu{
        position: fixed; left: 0; right: 0;
        display: flex; align-items: center;
        padding: 6px 12px;
        background: #8b0000;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid var(--border);
        z-index: 900;
        }
        nav.menu{ top: var(--h-header); height: var(--h-menu); }
        nav.submenu{ top: calc(var(--h-header) + var(--h-menu)); height: var(--h-submenu); }
        .tablist{
        display: flex;
        gap: 10px;
        width: 100%;
        overflow: auto;
        scrollbar-width: thin;
        padding-bottom: 2px;
        }
        .tablist::-webkit-scrollbar{ height: 8px; }
        .tablist::-webkit-scrollbar-thumb{ background: rgba(226,232,240,0.2); border-radius: 999px; }
        .tab{
        appearance: none;
        border: 1px solid rgba(226,232,240,0.18);
        background: var(--tab-bg);
        color: var(--tab-text);
        padding: 10px 14px;
        border-radius: 999px;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        white-space: nowrap;
        transition: transform 0.08s ease, background 0.18s ease, color 0.18s ease, border-color 0.18s ease;
        user-select: none;
        }
        .tab:hover{ transform: translateY(-1px); }
        .tab[aria-selected="true"]{
        background: var(--tab-active-bg);
        color: var(--tab-active-text);
        border-color: rgba(226,232,240,0.35);
        transform: translateY(0);
        }
        .tab:focus-visible{
        outline: 3px solid rgba(56,189,248,0.55);
        outline-offset: 2px;
        }
        .submenu.is-empty{
        opacity: 0.85;
        }
        .submenu-placeholder{
        font-size: 13px;
        color: var(--muted);
        padding: 0 6px;
        white-space: nowrap;
        }
        footer{
        position: fixed; inset: auto 0 0 0;
        height: var(--h-footer);
        display: flex; align-items: center; justify-content: center;
        padding: 0 14px;
        background: var(--panel-strong);
        backdrop-filter: blur(10px);
        border-top: 1px solid var(--border);
        box-shadow: var(--shadow-bottom);
        z-index: 1000;
        font-size: 12px;
        opacity: 0.95;
        }
        main{
        position: fixed;
        left: 0; right: 0;
        top: calc(var(--h-header) + var(--h-menu) + var(--h-submenu));
        bottom: var(--h-footer);
        overflow: auto;
        padding: 16px;
        }
        .page-title{
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        margin: 6px 4px 14px;
        }
        .page-title h1{
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.2px;
        }
        .page-title .meta{
        font-size: 12px;
        color: var(--muted);
        white-space: nowrap;
        }
        .grid{
        display: grid;
        grid-template-columns: repeat(3, minmax(220px, 1fr));
        grid-template-rows: repeat(2, minmax(170px, auto));
        gap: var(--gap);
        }
        .card{
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 14px 14px 12px;
        box-shadow: var(--shadow);
        min-height: 150px;
        }
        .card h2{
        margin: 0 0 8px 0;
        font-size: 15px;
        letter-spacing: 0.2px;
        }
        .card p{
        margin: 0;
        line-height: 1.45;
        color: var(--text);
        opacity: 0.95;
        font-size: 13px;
        }
        .muted{
        color: var(--muted);
        font-size: 12px;
        }
        .badge{
        display: inline-block;
        margin-top: 10px;
        font-size: 12px;
        color: #0b1220;
        background: var(--accent);
        padding: 4px 10px;
        border-radius: 999px;
        font-weight: 800;
        }
        .stack{ display: grid; gap: 10px; }
        .row{ display: flex; gap: 10px; flex-wrap: wrap; }
        input, textarea, select{
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(226,232,240,0.18);
        padding: 10px 12px;
        background: rgba(11,18,32,0.35);
        color: var(--text);
        outline: none;
        }
        label{
        font-size: 12px;
        color: var(--muted);
        display: grid;
        gap: 6px;
        }
        .btn{
        appearance: none;
        border: 1px solid rgba(226,232,240,0.25);
        background: rgba(226,232,240,0.10);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 10px;
        font-weight: 800;
        cursor: pointer;
        transition: transform 0.08s ease, background 0.18s ease;
        }
        .btn:hover{ transform: translateY(-1px); }
        .btn.primary{
        background: var(--tab-active-bg);
        color: var(--tab-active-text);
        border-color: rgba(226,232,240,0.35);
        }
        .kpis{
        display: grid;
        grid-template-columns: repeat(3, minmax(120px, 1fr));
        gap: 10px;
        }
        .kpi{
        border: 1px dashed rgba(226,232,240,0.18);
        border-radius: 12px;
        padding: 10px;
        }
        .kpi-label{ font-size: 12px; color: var(--muted); }
        .kpi-value{ font-size: 18px; font-weight: 900; margin-top: 4px; }
        .kpi-sub{ font-size: 12px; color: rgba(229,231,235,0.7); margin-top: 2px; }
        .feed{
        display: grid;
        gap: 10px;
        }
        .feed-item{
        border-left: 3px solid rgba(165,180,252,0.65);
        padding-left: 10px;
        }
        .feed-title{ font-weight: 900; }
        .feed-body{ opacity: 0.95; margin-top: 2px; }
        .feed-meta{ opacity: 0.7; font-size: 12px; margin-top: 4px; }
        .refs{
        margin: 0;
        padding-left: 18px;
        }
        .refs a{
        color: var(--accent);
        text-decoration: none;
        }
        .refs a:hover{ text-decoration: underline; }
        .chart{
        display: grid;
        gap: 10px;
        }
        .chart-title{
        font-weight: 900;
        font-size: 13px;
        color: var(--muted);
        }
        canvas{
        width: 100%;
        height: 160px;
        border-radius: 14px;
        border: 1px solid rgba(226,232,240,0.18);
        background: linear-gradient(135deg, rgba(165,180,252,0.10), rgba(56,189,248,0.05));
        }
        #main.is-fading{ opacity: 0.35; transition: opacity 0.12s ease; }
        #main{ transition: opacity 0.12s ease; }
        @media (max-width: 980px){
        .grid{ grid-template-columns: 1fr; grid-template-rows: auto; }
        .kpis{ grid-template-columns: 1fr; }
        header .hint{ display:none; }
        }
    </style>
</head>
<body>
    <header>
        <div class="brand">Sociom&egrave;tres UGICT CGT</div>
        <div class="hint">Quelque chose qui cloche dans le travail ?</div>
    </header>
    <nav class="menu" aria-label="Menu principal">
        <div class="tablist" id="menuTabs" role="tablist" aria-label="Onglets menu principal"></div>
    </nav>
    <nav class="submenu is-empty" aria-label="Sous-menu">
        <div class="tablist" id="submenuTabs" role="tablist" aria-label="Onglets sous-menu">
            <span class="submenu-placeholder" id="submenuPlaceholder"></span>
        </div>
    </nav>
    <main id="main" aria-live="polite"></main>
    <footer>
        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.fr" target="newtab"><svg viewBox="0 0 30 30" height="32px" width="32px"><g id="cc-logo"><path d="M14.972 0c4.196 0 7.769 1.465 10.715 4.393A14.426 14.426 0 0128.9 9.228C29.633 11.04 30 12.964 30 15c0 2.054-.363 3.978-1.085 5.772a13.77 13.77 0 01-3.2 4.754 15.417 15.417 0 01-4.983 3.322A14.932 14.932 0 0114.973 30c-1.982 0-3.88-.38-5.692-1.14a15.087 15.087 0 01-4.875-3.293c-1.437-1.437-2.531-3.058-3.281-4.862A14.71 14.71 0 010 15c0-1.982.38-3.888 1.138-5.719a15.062 15.062 0 013.308-4.915C7.303 1.456 10.812 0 14.972 0zm.055 2.706c-3.429 0-6.313 1.196-8.652 3.589a12.896 12.896 0 00-2.72 4.031 11.814 11.814 0 00-.95 4.675c0 1.607.316 3.156.95 4.646a12.428 12.428 0 002.72 3.992 12.362 12.362 0 003.99 2.679c1.483.616 3.037.924 4.662.924 1.607 0 3.164-.312 4.675-.937a12.954 12.954 0 004.084-2.705c2.339-2.286 3.508-5.152 3.508-8.6 0-1.66-.304-3.231-.91-4.713a11.994 11.994 0 00-2.651-3.965c-2.412-2.41-5.314-3.616-8.706-3.616zm-.188 9.803l-2.01 1.045c-.215-.445-.477-.758-.79-.937-.312-.178-.602-.268-.87-.268-1.34 0-2.01.884-2.01 2.652 0 .803.17 1.446.509 1.928.34.482.84.724 1.5.724.876 0 1.492-.43 1.85-1.286l1.847.937a4.407 4.407 0 01-1.634 1.728c-.696.42-1.464.63-2.303.63-1.34 0-2.42-.41-3.242-1.233-.821-.82-1.232-1.964-1.232-3.428 0-1.428.416-2.562 1.246-3.401.83-.84 1.879-1.26 3.147-1.26 1.858 0 3.188.723 3.992 2.17zm8.652 0l-1.983 1.045c-.214-.445-.478-.758-.79-.937-.313-.178-.613-.268-.897-.268-1.34 0-2.01.884-2.01 2.652 0 .803.17 1.446.51 1.928.338.482.838.724 1.5.724.874 0 1.49-.43 1.847-1.286l1.875.937a4.606 4.606 0 01-1.66 1.728c-.696.42-1.455.63-2.277.63-1.357 0-2.441-.41-3.253-1.233-.814-.82-1.22-1.964-1.22-3.428 0-1.428.415-2.562 1.246-3.401.83-.84 1.879-1.26 3.147-1.26 1.857 0 3.18.723 3.965 2.17z" fill="#cdcccc"></path></g></svg><svg viewBox="0 0 30 30" height="32px" width="32px"><g id="cc-by"><path d="M14.973 0c4.213 0 7.768 1.446 10.66 4.34C28.544 7.25 30 10.803 30 15c0 4.215-1.43 7.723-4.287 10.526C22.678 28.51 19.098 30 14.973 30c-4.054 0-7.571-1.474-10.553-4.42C1.474 22.633 0 19.107 0 15S1.474 7.34 4.42 4.34C7.313 1.446 10.83 0 14.973 0zm.054 2.706c-3.41 0-6.295 1.196-8.652 3.589-2.447 2.5-3.67 5.402-3.67 8.706 0 3.321 1.214 6.196 3.642 8.624 2.429 2.429 5.322 3.642 8.679 3.642 3.339 0 6.25-1.222 8.732-3.67 2.358-2.267 3.536-5.133 3.536-8.598 0-3.41-1.197-6.311-3.589-8.705-2.392-2.392-5.285-3.588-8.678-3.588zm4.018 8.57v6.134H17.33v7.286h-4.66V17.41h-1.714v-6.134a.93.93 0 01.28-.683.933.933 0 01.684-.281h6.161c.25 0 .474.093.67.28a.912.912 0 01.294.684zM12.91 7.42c0-1.41.696-2.116 2.09-2.116s2.09.705 2.09 2.116c0 1.393-.697 2.09-2.09 2.09-1.393 0-2.09-.697-2.09-2.09z" fill="#cdcccc"></path></g></svg><svg viewBox="0 0 30 30" height="32px" width="32px"><g id="cc-nc"><path d="M14.973 0c4.214 0 7.768 1.446 10.66 4.339C28.544 7.232 30 10.786 30 15c0 4.215-1.429 7.723-4.287 10.527C22.678 28.51 19.097 30 14.973 30c-4.072 0-7.59-1.482-10.553-4.446C1.474 22.607 0 19.09 0 15c0-4.107 1.474-7.66 4.42-10.66C7.313 1.446 10.83 0 14.973 0zM3.375 10.956c-.446 1.232-.67 2.58-.67 4.045 0 3.321 1.214 6.196 3.642 8.624 2.447 2.412 5.34 3.617 8.679 3.617 3.375 0 6.285-1.223 8.733-3.67.875-.839 1.561-1.714 2.061-2.626l-5.651-2.518a3.866 3.866 0 01-1.433 2.317c-.76.598-1.657.943-2.693 1.031v2.304h-1.74v-2.304c-1.661-.017-3.18-.615-4.554-1.794l2.063-2.089c.981.91 2.098 1.366 3.348 1.366.517 0 .96-.116 1.326-.349.366-.231.55-.615.55-1.151 0-.376-.135-.68-.402-.911l-1.447-.617-1.767-.804-2.384-1.044-7.661-3.427zm11.652-8.278c-3.41 0-6.295 1.206-8.652 3.616-.59.59-1.143 1.26-1.66 2.01l5.732 2.571a3.513 3.513 0 011.42-1.888c.695-.473 1.508-.737 2.437-.79V5.893h1.741v2.304c1.376.071 2.625.535 3.75 1.392L17.84 11.6c-.84-.59-1.697-.884-2.572-.884-.464 0-.88.09-1.245.267-.366.179-.55.483-.55.911 0 .125.045.25.134.375l1.902.858 1.313.59 2.41 1.07 7.687 3.429c.25-1.054.375-2.125.375-3.214 0-3.447-1.196-6.349-3.588-8.707-2.375-2.41-5.27-3.616-8.68-3.616z" fill="#cdcccc"></path></g></svg><svg viewBox="0 0 30 30" height="32px" width="32px"><g id="cc-sa"><path d="M14.973 0c4.196 0 7.75 1.455 10.66 4.366C28.544 7.26 30 10.804 30 15c0 4.197-1.43 7.714-4.287 10.553C22.696 28.518 19.115 30 14.973 30c-4.054 0-7.571-1.473-10.553-4.42C1.474 22.634 0 19.108 0 15c0-4.088 1.474-7.633 4.42-10.633C7.33 1.455 10.848 0 14.973 0zm.054 2.706c-3.41 0-6.295 1.205-8.652 3.616-2.447 2.483-3.67 5.375-3.67 8.678 0 3.34 1.214 6.214 3.642 8.625 2.429 2.43 5.322 3.643 8.679 3.643 3.339 0 6.25-1.223 8.732-3.67 2.358-2.285 3.536-5.151 3.536-8.598 0-3.428-1.197-6.321-3.589-8.678-2.375-2.412-5.268-3.616-8.678-3.616zM8.33 12.884c.286-1.84 1.026-3.264 2.223-4.273 1.196-1.008 2.651-1.513 4.366-1.513 2.356 0 4.232.76 5.625 2.277 1.393 1.517 2.09 3.464 2.09 5.839 0 2.304-.724 4.219-2.17 5.745-1.447 1.526-3.321 2.29-5.626 2.29-1.696 0-3.16-.508-4.392-1.527-1.233-1.018-1.973-2.464-2.224-4.339H12c.09 1.822 1.187 2.733 3.295 2.733 1.053 0 1.902-.456 2.544-1.366.644-.91.965-2.126.965-3.643 0-1.59-.294-2.799-.883-3.63-.59-.83-1.437-1.245-2.545-1.245-2.001 0-3.126.884-3.375 2.651h1.098l-2.973 2.973-2.973-2.973H8.33z" fill="#cdcccc"></path></g></svg></a>
        <a href="https://github.com/leithleith/sociometre" target="newtab"><svg height="32" fill="#cdcccc" stroke="#8b0000" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="32" data-view-component="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg></a>
    </footer>
    <script>
        const TOP_MENUS = [
            "Accueil",
            "QVT",
            "RPS",
            "Sociom√®tre de l‚Äôencadrant",
            "Violentom√®tre"
        ];
        const SUB_MENUS = [
            "Questionnaire",
            "Analyse individuelle",
            "Analyse groupe",
            "Analyse de collectif(s)"
        ];
        const state = {
            menu: "Accueil",
            sub: null
        };
        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
        function escapeHtml(str){
            return String(str).replace(/[&<>"']/g, m => ({
            "&":"&amp;",
            "<":"&lt;",
            ">":"&gt;",
            '"':"&quot;",
            "'":"&#039;"
            }[m]));
        }
        function setSelectedTabs(buttons, selectedValue, dataAttr){
            buttons.forEach(btn => {
            const val = btn.getAttribute(dataAttr);
            const isSelected = val === selectedValue;
            btn.setAttribute("aria-selected", isSelected ? "true" : "false");
            btn.tabIndex = isSelected ? 0 : -1;
            });
        }

        function enableArrowKeyNav(tabButtons){
            tabButtons.forEach((btn, idx) => {
            btn.addEventListener("keydown", (e) => {
                const keys = ["ArrowLeft","ArrowRight","Home","End"];
                if(!keys.includes(e.key)) return;

                e.preventDefault();
                let nextIndex = idx;

                if(e.key === "ArrowLeft")  nextIndex = (idx - 1 + tabButtons.length) % tabButtons.length;
                if(e.key === "ArrowRight") nextIndex = (idx + 1) % tabButtons.length;
                if(e.key === "Home")       nextIndex = 0;
                if(e.key === "End")        nextIndex = tabButtons.length - 1;

                tabButtons[nextIndex].focus();
                tabButtons[nextIndex].click();
            });
            });
        }

        function swapMain(html){
            const main = $("#main");
            main.classList.add("is-fading");
            requestAnimationFrame(() => {
            main.innerHTML = html;
            main.classList.remove("is-fading");
            });
        }

        /***********************
         * UI Builders (composants)
         ***********************/
        function PageShell({title, meta, content}){
            return `
            <div class="page-title">
                <h1>${escapeHtml(title)}</h1>
                <div class="meta">${escapeHtml(meta || "")}</div>
            </div>
            ${content}
            `;
        }

        function card(title, html){
            return `
            <article class="card">
                <h2>${escapeHtml(title)}</h2>
                ${html}
            </article>
            `;
        }

        // Grid 2 lignes x 3 colonnes (6 emplacements)
        function grid6(c1, c2, c3, c4, c5, c6){
            return `
            <section class="grid" aria-label="Grille principale">
                ${c1}${c2}${c3}${c4}${c5}${c6}
            </section>
            `;
        }

        const Widgets = {
            questionnaireForm(menu, sub){
            const themeId = `theme_${Math.random().toString(16).slice(2)}`;
            const commentId = `comment_${Math.random().toString(16).slice(2)}`;
            return `
                <form class="stack" onsubmit="event.preventDefault(); alert('Enregistr√© (mock)');">
                <div class="muted">Contexte : <b>${escapeHtml(menu)}</b> ‚Ä¢ Vue : <b>${escapeHtml(sub)}</b></div>

                <label for="${themeId}">
                    Th√®me
                    <input id="${themeId}" placeholder="Charge, conflits, s√©curit√©, reconnaissance..." />
                </label>

                <label for="${commentId}">
                    Commentaire
                    <textarea id="${commentId}" rows="4" placeholder="D√©cris la situation / les √©l√©ments observ√©s..."></textarea>
                </label>

                <div class="row">
                    <button class="btn primary" type="submit">Enregistrer</button>
                    <button class="btn" type="button" onclick="alert('Export (mock)')">Exporter</button>
                    <button class="btn" type="button" onclick="alert('R√©initialis√© (mock)')">R√©initialiser</button>
                </div>

                <div class="muted">üí° Astuce : garde les donn√©es anonymis√©es / agr√©g√©es si besoin.</div>
                </form>
            `;
            },

            kpiStrip(items){
            return `
                <div class="kpis">
                ${items.map(k => `
                    <div class="kpi">
                    <div class="kpi-label">${escapeHtml(k.label)}</div>
                    <div class="kpi-value">${escapeHtml(k.value)}</div>
                    <div class="kpi-sub">${escapeHtml(k.sub || "")}</div>
                    </div>
                `).join("")}
                </div>
            `;
            },

            messageFeed(messages){
            return `
                <div class="feed">
                ${messages.map(m => `
                    <div class="feed-item">
                    <div class="feed-title">${escapeHtml(m.title)}</div>
                    <div class="feed-body">${escapeHtml(m.body)}</div>
                    <div class="feed-meta">${escapeHtml(m.meta || "")}</div>
                    </div>
                `).join("")}
                </div>
            `;
            },

            referencesList(refs){
            return `
                <ul class="refs">
                ${refs.map(r => `
                    <li><a href="#" onclick="event.preventDefault(); alert('Ouvrir : ${escapeHtml(r)}')">${escapeHtml(r)}</a></li>
                `).join("")}
                </ul>
            `;
            },

            chartBlock({title, canvasId, hint}){
            return `
                <div class="chart">
                <div class="chart-title">${escapeHtml(title)} <span class="muted">${escapeHtml(hint || "")}</span></div>
                <canvas id="${escapeHtml(canvasId)}" width="800" height="220" role="img" aria-label="${escapeHtml(title)}"></canvas>
                </div>
            `;
            }
        };

        /***********************
         * Mini moteur de chart (barres) sans lib
         ***********************/
        function drawBarChart(canvasId, labels, values, colorA = "rgba(165,180,252,0.85)", colorB = "rgba(56,189,248,0.75)"){
            const c = document.getElementById(canvasId);
            if(!c) return;
            const ctx = c.getContext("2d");

            // nettoie
            ctx.clearRect(0,0,c.width,c.height);

            // dimensions
            const W = c.width, H = c.height;
            const pad = 28;
            const baseY = H - pad;
            const maxV = Math.max(...values, 1);

            // axes l√©gers
            ctx.strokeStyle = "rgba(226,232,240,0.18)";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pad, pad);
            ctx.lineTo(pad, baseY);
            ctx.lineTo(W - pad, baseY);
            ctx.stroke();

            // barres
            const n = values.length;
            const usableW = (W - pad*2);
            const gap = Math.max(10, usableW * 0.02);
            const barW = (usableW - gap*(n-1)) / n;

            // labels
            ctx.font = "12px system-ui, -apple-system, Segoe UI, Roboto, Arial";
            ctx.fillStyle = "rgba(229,231,235,0.75)";

            values.forEach((v, i) => {
            const x = pad + i*(barW+gap);
            const h = (v / maxV) * (H - pad*2 - 20);
            const y = baseY - h;

            // gradient barre
            const grad = ctx.createLinearGradient(0, y, 0, baseY);
            grad.addColorStop(0, colorB);
            grad.addColorStop(1, colorA);
            ctx.fillStyle = grad;

            ctx.beginPath();
            const r = 10;
            roundRect(ctx, x, y, barW, h, r);
            ctx.fill();

            // valeur
            ctx.fillStyle = "rgba(229,231,235,0.9)";
            ctx.fillText(String(v), x + 6, y - 6);

            // label
            ctx.fillStyle = "rgba(229,231,235,0.75)";
            const lab = labels[i] || "";
            ctx.fillText(lab, x + 4, baseY + 18);
            });
        }

        function roundRect(ctx, x, y, w, h, r){
            const rr = Math.min(r, w/2, h/2);
            ctx.moveTo(x+rr, y);
            ctx.arcTo(x+w, y, x+w, y+h, rr);
            ctx.arcTo(x+w, y+h, x, y+h, rr);
            ctx.arcTo(x, y+h, x, y, rr);
            ctx.arcTo(x, y, x+w, y, rr);
            ctx.closePath();
        }

        /***********************
         * Vues : chaque vue remplace TOUTE la grille
         * Views[menu][sub] => function(ctx) => HTML complet
         ***********************/
        const Views = {
            "QVT": {
            "Questionnaire": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : questionnaire",
                content: grid6(
                card("Questionnaire", Widgets.questionnaireForm(ctx.menu, ctx.sub)),
                card("Messages", Widgets.messageFeed([
                    {title:"Rappel", body:"Respecter l‚Äôanonymat si n√©cessaire.", meta:"Conseil"},
                    {title:"Tip", body:"Limiter √† 10‚Äì12 questions par session.", meta:"Qualit√©"},
                    {title:"Info", body:"Conserver une logique de dimensions (charge, autonomie, reconnaissance‚Ä¶).", meta:"M√©thodo"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Guide QVT (interne)",
                    "FAQ QVT",
                    "M√©thodologie de passation"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Taux de r√©ponse", value:"‚Äî", sub:"(mock)"},
                    {label:"Nb. r√©ponses", value:"‚Äî", sub:"(mock)"},
                    {label:"Alertes", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"R√©partition des r√©ponses", canvasId:"qvt_q_bar" })),
                card("Graphique 2", Widgets.chartBlock({ title:"√âvolution (p√©riode)", canvasId:"qvt_q_trend" }))
                )
            }),

            "Analyse individuelle": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : individu",
                content: grid6(
                card("Synth√®se", `
                    <p>Analyse individuelle (placeholder) : tendances, points de vigilance, recommandations.</p>
                    <span class="badge">Restitution 1:1</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Note", body:"Afficher uniquement des donn√©es anonymis√©es si besoin.", meta:"Confidentialit√©"},
                    {title:"Astuce", body:"Mettre en avant 2 forces + 1 axe d‚Äôam√©lioration max.", meta:"Coaching"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Mod√®le de restitution",
                    "Grille d‚Äôentretien",
                    "Plan d‚Äôaction individuel"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Indice", value:"‚Äî", sub:"(mock)"},
                    {label:"Variance", value:"‚Äî", sub:"(mock)"},
                    {label:"Confiance", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Radar (placeholder)", canvasId:"qvt_ai_radar" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Barres par dimension", canvasId:"qvt_ai_bar" }))
                )
            }),

            "Analyse groupe": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : groupe",
                content: grid6(
                card("Comparaison par groupe", `
                    <p>Analyse QVT par √©quipe/service : filtres, segmentations, signaux faibles.</p>
                    <span class="badge">Agr√©g√©</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Astuce", body:"Pr√©voir filtres (√©quipe, site, m√©tier).", meta:"UX"},
                    {title:"Note", body:"Attention aux petits effectifs (r√©-identification).", meta:"Confidentialit√©"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Seuils d‚Äôanonymat",
                    "Glossaire des dimensions",
                    "M√©thodologie d‚Äôanalyse"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Moyenne", value:"‚Äî", sub:"(mock)"},
                    {label:"M√©diane", value:"‚Äî", sub:"(mock)"},
                    {label:"N", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Comparaison √©quipes", canvasId:"qvt_ag_comp" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Heatmap (placeholder)", canvasId:"qvt_ag_heat" }))
                )
            }),

            "Analyse de collectif(s)": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : collectif(s)",
                content: grid6(
                card("Ateliers / Collectifs", `
                    <p>Analyse par collectif(s) : verbatims, ateliers, plan d‚Äôactions, suivi.</p>
                    <span class="badge">Atelier</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Action", body:"Transformer chaque irritant en action mesurable.", meta:"Plan d‚Äôactions"},
                    {title:"Tip", body:"Limiter √† 3‚Äì5 actions prioritaires par cycle.", meta:"Pilotage"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Trame atelier",
                    "Exemples de plan d‚Äôaction",
                    "Mod√®le de suivi"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Irritants", value:"‚Äî", sub:"(mock)"},
                    {label:"Actions", value:"‚Äî", sub:"(mock)"},
                    {label:"Owners", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Top irritants", canvasId:"qvt_ac_top" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Suivi actions", canvasId:"qvt_ac_follow" }))
                )
            })
            },

            "RPS": {
            "Questionnaire": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : questionnaire",
                content: grid6(
                card("Questionnaire", Widgets.questionnaireForm(ctx.menu, ctx.sub)),
                card("Messages", Widgets.messageFeed([
                    {title:"Point l√©gal", body:"√âviter toute donn√©e nominative inutile.", meta:"Conformit√©"},
                    {title:"Alerte", body:"Pr√©voir un seuil d‚Äôanonymat avant affichage.", meta:"Confidentialit√©"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Cadre RPS",
                    "Proc√©dure d‚Äôalerte",
                    "Contacts pr√©vention"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Niveau de risque", value:"‚Äî", sub:"(mock)"},
                    {label:"Signalements", value:"‚Äî", sub:"(mock)"},
                    {label:"Seuils", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Score par facteur", canvasId:"rps_q_factors" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Distribution", canvasId:"rps_q_dist" }))
                )
            }),

            "Analyse individuelle": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : individu",
                content: grid6(
                card("Synth√®se individuelle", `
                    <p>Rep√©rage des facteurs dominants (charge, conflit, isolement‚Ä¶).</p>
                    <span class="badge">Acc√®s contr√¥l√©</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Sensibilit√©", body:"Restreindre l‚Äôacc√®s selon r√¥les/permissions.", meta:"S√©curit√©"},
                    {title:"Conseil", body:"Privil√©gier les tendances plut√¥t que les d√©tails.", meta:"Pratique"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Guide d‚Äôentretien",
                    "Ressources support",
                    "Orientation / escalade"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Risque", value:"‚Äî", sub:"(mock)"},
                    {label:"Facteur #1", value:"‚Äî", sub:"(mock)"},
                    {label:"Facteur #2", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Radar facteurs", canvasId:"rps_ai_radar" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Historique", canvasId:"rps_ai_hist" }))
                )
            }),

            "Analyse groupe": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : groupe",
                content: grid6(
                card("Vue groupe", `
                    <p>Analyse par √©quipe : comparaison inter-groupes, signaux faibles, tendances.</p>
                    <span class="badge">Agr√©g√©</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Note", body:"Bloquer l‚Äôaffichage si N trop faible.", meta:"Anonymat"},
                    {title:"Tip", body:"Comparer par p√©riode et par facteur.", meta:"Analyse"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "R√®gles d‚Äôanonymat",
                    "M√©thodologie",
                    "Seuils & alertes"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"N", value:"‚Äî", sub:"(mock)"},
                    {label:"Risque moyen", value:"‚Äî", sub:"(mock)"},
                    {label:"√âcart-type", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Comparaison groupes", canvasId:"rps_ag_groups" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Heatmap facteurs", canvasId:"rps_ag_heat" }))
                )
            }),

            "Analyse de collectif(s)": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : collectif(s)",
                content: grid6(
                card("Collectif(s)", `
                    <p>Ateliers, verbatims structur√©s, plan de pr√©vention, suivi d‚Äôactions.</p>
                    <span class="badge">Pr√©vention</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Plan", body:"Transformer chaque risque en action mesurable (owner + date).", meta:"Pilotage"},
                    {title:"Tip", body:"Documenter les d√©cisions d‚Äôatelier.", meta:"Tra√ßabilit√©"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Plan de pr√©vention type",
                    "Exemples d‚Äôactions",
                    "Trame atelier"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Risques", value:"‚Äî", sub:"(mock)"},
                    {label:"Actions", value:"‚Äî", sub:"(mock)"},
                    {label:"Suivi", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Top risques", canvasId:"rps_ac_top" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Suivi actions", canvasId:"rps_ac_follow" }))
                )
            })
            },

            "Sociom√®tre de l‚Äôencadrant": {
            "Questionnaire": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : questionnaire",
                content: grid6(
                card("Questionnaire", Widgets.questionnaireForm(ctx.menu, ctx.sub)),
                card("Messages", Widgets.messageFeed([
                    {title:"Objectif", body:"Mesurer le climat et la relation manag√©riale.", meta:"Contexte"},
                    {title:"Tip", body:"Conserver une restitution centr√©e sur les comportements observables.", meta:"Coaching"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "R√©f√©rentiel comp√©tences",
                    "Trame feedback",
                    "Ressources formation"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Climat", value:"‚Äî", sub:"(mock)"},
                    {label:"Confiance", value:"‚Äî", sub:"(mock)"},
                    {label:"Feedback", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Dimensions relationnelles", canvasId:"soc_q_dims" })),
                card("Graphique 2", Widgets.chartBlock({ title:"√âvolution", canvasId:"soc_q_trend" }))
                )
            }),

            "Analyse individuelle": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : individu",
                content: grid6(
                card("Synth√®se", `
                    <p>Lecture individuelle : forces / axes d‚Äôam√©lioration (placeholder).</p>
                    <span class="badge">Coaching</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Focus", body:"Limiter √† 3 axes prioritaires.", meta:"Efficacit√©"},
                    {title:"Tip", body:"Proposer actions concr√®tes & mesurables.", meta:"Plan"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Guide coaching",
                    "Ressources formation",
                    "Fiches pratiques"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Score", value:"‚Äî", sub:"(mock)"},
                    {label:"√âcart", value:"‚Äî", sub:"(mock)"},
                    {label:"N", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Radar", canvasId:"soc_ai_radar" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Barres", canvasId:"soc_ai_bar" }))
                )
            }),

            "Analyse groupe": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : groupe",
                content: grid6(
                card("Comparaison", `
                    <p>Comparer √©quipes / collectifs sur dimensions relationnelles (placeholder).</p>
                    <span class="badge">Agr√©g√©</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Note", body:"Pr√©voir seuil d‚Äôanonymat avant affichage.", meta:"Confidentialit√©"},
                    {title:"Tip", body:"Analyser par site / m√©tier si pertinent.", meta:"Segmentation"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "M√©thodo",
                    "Seuils anonymat",
                    "Grille d‚Äôanalyse"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"N", value:"‚Äî", sub:"(mock)"},
                    {label:"Moyenne", value:"‚Äî", sub:"(mock)"},
                    {label:"Dispersion", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Comparaison √©quipes", canvasId:"soc_ag_comp" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Heatmap", canvasId:"soc_ag_heat" }))
                )
            }),

            "Analyse de collectif(s)": (ctx) => PageShell({
                title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                meta: "Vue : collectif(s)",
                content: grid6(
                card("Ateliers / engagements", `
                    <p>Ateliers de r√©gulation, engagements, suivi (placeholder).</p>
                    <span class="badge">Engagements</span>
                `),
                card("Messages", Widgets.messageFeed([
                    {title:"Action", body:"D√©finir 3 engagements max par cycle.", meta:"Pilotage"},
                    {title:"Tip", body:"Suivre l‚Äôavancement (owner + date).", meta:"Suivi"}
                ])),
                card("R√©f√©rences", Widgets.referencesList([
                    "Trame atelier",
                    "Exemples engagements",
                    "Mod√®le de suivi"
                ])),
                card("Statistiques", Widgets.kpiStrip([
                    {label:"Engagements", value:"‚Äî", sub:"(mock)"},
                    {label:"Avancement", value:"‚Äî", sub:"(mock)"},
                    {label:"Risques", value:"‚Äî", sub:"(mock)"}
                ])),
                card("Graphique 1", Widgets.chartBlock({ title:"Kanban (placeholder)", canvasId:"soc_ac_kanban" })),
                card("Graphique 2", Widgets.chartBlock({ title:"Suivi", canvasId:"soc_ac_follow" }))
                )
            })
            },
            "Violentom√®tre": {
                "Questionnaire": (ctx) => PageShell({
                    title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                    meta: "Vue : questionnaire",
                    content: grid6(
                    card("Questionnaire", Widgets.questionnaireForm(ctx.menu, ctx.sub)),
                    card("Messages", Widgets.messageFeed([
                        {title:"Alerte", body:"Pr√©voir un bouton ‚Äúsignaler‚Äù + ressources d‚Äôaide.", meta:"S√©curit√©"},
                        {title:"Note", body:"Restreindre l‚Äôacc√®s / tracer les actions si n√©cessaire.", meta:"Gouvernance"}
                    ])),
                    card("R√©f√©rences", Widgets.referencesList([
                        "Ressources d‚Äôaide",
                        "Proc√©dure de signalement",
                        "Contacts urgents"
                    ])),
                    card("Statistiques", Widgets.kpiStrip([
                        {label:"Niveau", value:"‚Äî", sub:"(mock)"},
                        {label:"Alertes", value:"‚Äî", sub:"(mock)"},
                        {label:"Suivi", value:"‚Äî", sub:"(mock)"}
                    ])),
                    card("Graphique 1", Widgets.chartBlock({ title:"√âchelle (placeholder)", canvasId:"vio_q_scale" })),
                    card("Graphique 2", Widgets.chartBlock({ title:"Tendance", canvasId:"vio_q_trend" }))
                    )
                }),
                "Analyse individuelle": (ctx) => PageShell({
                    title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                    meta: "Vue : individu",
                    content: grid6(
                    card("Restitution prudente", `
                        <p>Restitution individuelle : acc√®s contr√¥l√©, minimiser les donn√©es sensibles.</p>
                        <span class="badge">Confidentiel</span>
                    `),
                    card("Messages", Widgets.messageFeed([
                        {title:"Important", body:"Masquer tout identifiant personnel si non n√©cessaire.", meta:"Privacy"},
                        {title:"Action", body:"Pr√©voir parcours d‚Äôescalade.", meta:"Process"}
                    ])),
                    card("R√©f√©rences", Widgets.referencesList([
                        "Charte confidentialit√©",
                        "Parcours d‚Äôescalade",
                        "Contacts support"
                    ])),
                    card("Statistiques", Widgets.kpiStrip([
                        {label:"Niveau", value:"‚Äî", sub:"(mock)"},
                        {label:"R√©currence", value:"‚Äî", sub:"(mock)"},
                        {label:"Signalement", value:"‚Äî", sub:"(mock)"}
                    ])),
                    card("Graphique 1", Widgets.chartBlock({ title:"√âchelle", canvasId:"vio_ai_scale" })),
                    card("Graphique 2", Widgets.chartBlock({ title:"Chronologie", canvasId:"vio_ai_time" }))
                    )
                }),
                "Analyse groupe": (ctx) => PageShell({
                    title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                    meta: "Vue : groupe",
                    content: grid6(
                    card("Vue agr√©g√©e", `
                        <p>Analyse groupe : agr√©gation uniquement, anti r√©-identification.</p>
                        <span class="badge">Agr√©g√©</span>
                    `),
                    card("Messages", Widgets.messageFeed([
                        {title:"Prudence", body:"Bloquer l‚Äôaffichage si N trop faible.", meta:"Anonymat"},
                        {title:"Tip", body:"Montrer tendances / distribution plut√¥t que d√©tails.", meta:"UX"}
                    ])),
                    card("R√©f√©rences", Widgets.referencesList([
                        "R√®gles d‚Äôanonymat",
                        "Proc√©dure pr√©vention",
                        "Guide de communication"
                    ])),
                    card("Statistiques", Widgets.kpiStrip([
                        {label:"N", value:"‚Äî", sub:"(mock)"},
                        {label:"Niveau moyen", value:"‚Äî", sub:"(mock)"},
                        {label:"Pics", value:"‚Äî", sub:"(mock)"}
                    ])),
                    card("Graphique 1", Widgets.chartBlock({ title:"Barres niveaux", canvasId:"vio_ag_levels" })),
                    card("Graphique 2", Widgets.chartBlock({ title:"Heatmap p√©riodes", canvasId:"vio_ag_heat" }))
                    )
                }),
                "Analyse de collectif(s)": (ctx) => PageShell({
                    title: `${ctx.menu} ‚Ä¢ ${ctx.sub}`,
                    meta: "Vue : collectif(s)",
                    content: grid6(
                    card("Plan d‚Äôactions", `
                        <p>Plan d‚Äôactions, sensibilisation, suivi (placeholder).</p>
                        <span class="badge">Plan</span>
                    `),
                    card("Messages", Widgets.messageFeed([
                        {title:"Action", body:"Associer chaque action √† un owner + une date.", meta:"Pilotage"},
                        {title:"Tip", body:"Mesurer l‚Äôimpact avant/apr√®s.", meta:"√âvaluation"}
                    ])),
                    card("R√©f√©rences", Widgets.referencesList([
                        "Trame plan d‚Äôaction",
                        "Kit sensibilisation",
                        "Mod√®le de suivi"
                    ])),
                    card("Statistiques", Widgets.kpiStrip([
                        {label:"Actions", value:"‚Äî", sub:"(mock)"},
                        {label:"Owners", value:"‚Äî", sub:"(mock)"},
                        {label:"√âch√©ances", value:"‚Äî", sub:"(mock)"}
                    ])),
                    card("Graphique 1", Widgets.chartBlock({ title:"Avancement actions", canvasId:"vio_ac_progress" })),
                    card("Graphique 2", Widgets.chartBlock({ title:"Impact", canvasId:"vio_ac_impact" }))
                    )
                })
            }
        };
        function buildMenu(){
            const container = $("#menuTabs");
            container.innerHTML = "";

            TOP_MENUS.forEach(label => {
                const btn = document.createElement("button");
                btn.className = "tab";
                    btn.type = "button";
                    btn.role = "tab";
                    btn.textContent = label;
                    btn.dataset.menu = label;
                    btn.setAttribute("aria-selected", label === state.menu ? "true" : "false");
                    btn.tabIndex = label === state.menu ? 0 : -1;
                    container.appendChild(btn);
            });
            const menuButtons = $$(".tab", container);
            menuButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    state.menu = btn.dataset.menu;
                    state.sub = null;
                    setSelectedTabs(menuButtons, state.menu, "data-menu");
                    buildSubmenu();
                    renderMain();
                });
            });
            enableArrowKeyNav(menuButtons);
        }
        function buildSubmenu(){
            const container = $("#submenuTabs");
            const placeholder = $("#submenuPlaceholder");
            $$(".submenu-btn", container).forEach(b => b.remove());
            if(state.menu === "Accueil"){
                state.sub = null;
                placeholder.style.display = "inline-block";
                container.parentElement.classList.add("is-empty");
                return;
            }
            placeholder.style.display = "none";
            container.parentElement.classList.remove("is-empty");
            if(!state.sub) state.sub = SUB_MENUS[0];
            SUB_MENUS.forEach(label => {
                const btn = document.createElement("button");
                btn.className = "tab submenu-btn";
                btn.type = "button";
                btn.role = "tab";
                btn.textContent = label;
                btn.dataset.submenu = label;
                btn.setAttribute("aria-selected", label === state.sub ? "true" : "false");
                btn.tabIndex = label === state.sub ? 0 : -1;
                container.appendChild(btn);
            });
            const subButtons = $$(".submenu-btn", container);
            subButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    state.sub = btn.dataset.submenu;
                    setSelectedTabs(subButtons, state.sub, "data-submenu");
                    renderMain();
                });
            });
            enableArrowKeyNav(subButtons);
        }
        function HomeView(){
            return PageShell({
                title: "Accueil",
                meta: "Sous-menu : vide",
                content: `
                    <section class="grid" aria-label="Accueil (grille libre)">
                    ${card("Bienvenue", `
                        <p>S√©lectionne un onglet du menu (QVT / RPS / Sociom√®tre / Violentom√®tre) pour afficher le sous-menu, puis une vue.</p>
                        <span class="badge">Mode Accueil</span>
                    `)}
                    ${card("Zone info", `<p>Placeholder : consignes, nouveaut√©s, liens rapides.</p>`)}
                    ${card("Zone aide", `<p>Placeholder : documentation, contact, FAQ.</p>`)}
                    ${card("Raccourcis", `<p>Placeholder : actions fr√©quentes.</p>`)}
                    ${card("Annonces", `<p>Placeholder : messages, communications.</p>`)}
                    ${card("Calendrier", `<p>Placeholder : √©ch√©ances, planning.</p>`)}
                    </section>
                `
            });
        }
        function NotFoundView(menu, sub){
            return PageShell({
                title: `${menu} ‚Ä¢ ${sub || "‚Äî"}`,
                meta: "Vue introuvable",
                content: `
                    <section class="grid" aria-label="Erreur">
                    ${card("Erreur", `<p>Aucune vue d√©finie pour <b>${escapeHtml(menu)}</b> / <b>${escapeHtml(sub || "‚Äî")}</b>.</p>`)}
                    ${card("Conseil", `<p>Ajoute une entr√©e dans <code>Views[menu][sub]</code>.</p>`)}
                    ${card("Debug", `<p class="muted">menu=${escapeHtml(menu)} ‚Ä¢ sub=${escapeHtml(sub || "null")}</p>`)}
                    ${card("‚Äî", `<p class="muted">‚Äî</p>`)}
                    ${card("‚Äî", `<p class="muted">‚Äî</p>`)}
                    ${card("‚Äî", `<p class="muted">‚Äî</p>`)}
                    </section>
                `
            });
        }
        function renderMain(){
            let html = "";
            if(state.menu === "Accueil"){
                html = HomeView();
                swapMain(html);
                return;
            }
            const menu = state.menu;
            const sub = state.sub || SUB_MENUS[0];
            const viewFn = Views?.[menu]?.[sub];
            html = viewFn
            ? viewFn({menu, sub})
            : NotFoundView(menu, sub);
            swapMain(html);

            // Dessins (mock) : on dessine quelques graphes selon la vue
            requestAnimationFrame(() => drawCharts(menu, sub));
        }

        /***********************
         * Charts mock selon vue
         ***********************/
        function drawCharts(menu, sub){
            // valeurs mock simples : tu pourras remplacer par tes data r√©elles
            const labels = ["A","B","C","D","E","F"];
            const rand = () => labels.map(() => Math.floor(10 + Math.random()*90));

            // on tente de dessiner si le canvas existe
            // (chaque vue a ses ids canvas sp√©cifiques)
            const tryDraw = (id) => drawBarChart(id, labels, rand());

            // QVT
            if(menu === "QVT" && sub === "Questionnaire"){
            tryDraw("qvt_q_bar"); tryDraw("qvt_q_trend");
            }
            if(menu === "QVT" && sub === "Analyse individuelle"){
            tryDraw("qvt_ai_radar"); tryDraw("qvt_ai_bar");
            }
            if(menu === "QVT" && sub === "Analyse groupe"){
            tryDraw("qvt_ag_comp"); tryDraw("qvt_ag_heat");
            }
            if(menu === "QVT" && sub === "Analyse de collectif(s)"){
            tryDraw("qvt_ac_top"); tryDraw("qvt_ac_follow");
            }

            // RPS
            if(menu === "RPS" && sub === "Questionnaire"){
            tryDraw("rps_q_factors"); tryDraw("rps_q_dist");
            }
            if(menu === "RPS" && sub === "Analyse individuelle"){
            tryDraw("rps_ai_radar"); tryDraw("rps_ai_hist");
            }
            if(menu === "RPS" && sub === "Analyse groupe"){
            tryDraw("rps_ag_groups"); tryDraw("rps_ag_heat");
            }
            if(menu === "RPS" && sub === "Analyse de collectif(s)"){
            tryDraw("rps_ac_top"); tryDraw("rps_ac_follow");
            }

            // Sociom√®tre
            if(menu === "Sociom√®tre de l‚Äôencadrant" && sub === "Questionnaire"){
            tryDraw("soc_q_dims"); tryDraw("soc_q_trend");
            }
            if(menu === "Sociom√®tre de l‚Äôencadrant" && sub === "Analyse individuelle"){
            tryDraw("soc_ai_radar"); tryDraw("soc_ai_bar");
            }
            if(menu === "Sociom√®tre de l‚Äôencadrant" && sub === "Analyse groupe"){
            tryDraw("soc_ag_comp"); tryDraw("soc_ag_heat");
            }
            if(menu === "Sociom√®tre de l‚Äôencadrant" && sub === "Analyse de collectif(s)"){
            tryDraw("soc_ac_kanban"); tryDraw("soc_ac_follow");
            }

            // Violentom√®tre
            if(menu === "Violentom√®tre" && sub === "Questionnaire"){
            tryDraw("vio_q_scale"); tryDraw("vio_q_trend");
            }
            if(menu === "Violentom√®tre" && sub === "Analyse individuelle"){
            tryDraw("vio_ai_scale"); tryDraw("vio_ai_time");
            }
            if(menu === "Violentom√®tre" && sub === "Analyse groupe"){
            tryDraw("vio_ag_levels"); tryDraw("vio_ag_heat");
            }
            if(menu === "Violentom√®tre" && sub === "Analyse de collectif(s)"){
            tryDraw("vio_ac_progress"); tryDraw("vio_ac_impact");
            }
        }
        function init(){
            buildMenu();
            buildSubmenu();
            renderMain();
        }
        init();
    </script>
</body>
</html>